<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>发布信息</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
  <header>
  <div class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="friend_index">upload goods</a>
        </div>
        <div class="hidden-xs">
            <div class="col-sm-offset-2">
                <ul class="nav navbar-nav navbar-list">
                    <li><a href="#">商品上传</a></li>
                </ul>
            </div>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="second_hand" target="_self" rel="noopener noreferrer">首页</a></li>
                <li><a href="right_menu" target="_self" rel="noopener noreferrer">我的二货</a></li>
  			    <li><a href="personal_info" target="_self" rel="noopener noreferrer">账号信息</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false" style="margin-right: 25px;">
                        <span class="hello">Welcome!</span>
                    </a>
                </li>
            </ul>  
        </div>
    </div>
	</div>
	</header>
	<div class="container">
		<div class="public-nav">您当前的位置：<a href="">发布信息</a>></div>
		<div class="public-content" style="margin-top: 0">
			<div class="public-content-cont">
			<form action="" enctype="multipart/form-data" style="margin:0 auto;width:50%">
				<s:actionmessage style="font-size:18px;color:#000"/>
				<input type="hidden" id="uuid" value="" name="creatorId"/>
				<div class="form-group">
					<label for="">请选择标签</label>
					<select name="classifyId" class="form-select" style="height: 30px;" id="classify">
						<option value="0">服装</option>
						<option value="1">饮食</option>
						<option value="2">玩具</option>
						<option value="3">账号</option>
						<option value="4">书籍</option>
						<option value="5">线上</option>
					</select>
				</div>
				<div class="form-group">
					<label for="">请选择类型</label>
					<select name="type" class="form-select" style="height: 30px;" id="classifys">
						<option value="0">求购</option>
						<option value="1">求售</option>
					</select>
				</div>
				<div class="form-group">
					<label for="">商品名称</label>
					<input class="form-input-txt" id="good_name" type="text" name="proName" value="" />
				</div>
				<div class="form-group">
					<label for="">商品价格</label>
					<input class="form-input-txt" id="good_price" type="text" name="proPrice" value="" />
				</div>
				<div class="form-group">
					<label for="">商品描述</label>
					<textarea class="form-input-textara" id="good_detail" type="text" name="proDesc"></textarea>
				</div>
				
				<div class="form-group">
					<label for="">区域</label>
					<input class="form-input-txt" id="good_area" type="text" name="proHassum" value="" />
				</div>
				<div class="form-group">
					<label for="">商品图片</label>					
					<input class="" type="file" id="myfile" name="proPictureFile" value="" />
					
				</div>
				
				<div id="large"></div>
				<div class="form-group" style="margin-left:150px;">
					<button class="sub-btn" type="button" onclick="submit()">提交</button>
					<input type="reset" class="sub-btn" value="重  置" />
				</div>
				</form>
			</div>
		</div>
	</div>
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  	<script src="js/jquery-3.3.1.min.js"></script>
  	<!-- Include all compiled plugins (below), or include individual files as needed -->
  	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.min.js"></script>
</body>
<script type="text/javascript">
	$(document).ready(function(){
		loadClassify();
		var uid=${param.uid};
		if(uid!=0){
			$("#uuid").val(uid);
		}
		});
	
	 function checkForm(form){
		 if(form.classifyId.value==""){
			 alert("分类不能为空！");
			 return false;
		}
		if(form.type.value==""){
			alert("类型不能为空！");
			return false;
		}
		if(form.proName.value==""){
			alert("商品名称不能为空！");
			return false;
		}
		if(form.proPrice.value==""){
			alert("商品价格不能为空！");
			return false;
		}
		var re = /^[0-9]+.?[0-9]*$/; 
		if(!re.test(form.proPrice.value)){
			alert("请输入数字");
			return false;
		}
		if(form.proHassum.value==""){
			alert("剩余量或需求量不能为空！");
			return false;
		}
		if(!re.test(form.proHassum.value)){
			alert("请输入数字");
			return false;
		}
		
	}
	
	function loadClassify(){
		$("#classify").html("");
		$.get("product_searchClassifyList.action",function(result){
			var data=result.data;
			var len=result.length;
			var temp='<option value="">请选择分类</option>';
			for(var i=0;i<len;i++){
				temp+='<option value="'+data[i].cid+'">'+data[i].classifyName+'</option>';
			}
				$("#classify").append(temp);
			
			},"json");
	}
	 
</script>
<script type="text/javascript">
	function submit()
 {
	var P_price = document.getElementById("good_price").value;	
 	var P_url = document.getElementById("myfile").value;
 	var P_tag = document.getElementById("classify").value;	
 	var P_title = document.getElementById("good_name").value;	
 	var P_text = document.getElementById("good_detail").value;	
 	var P_area = document.getElementById("good_area").value;	
 	var data = {"P_price":P_price,"P_url":P_url,"P_tag":P_tag,"P_title":P_title,"P_text":P_text,"P_area":P_area};
    $.ajax
    ({
    	url: "http://localhost:8080/home/trade/goodsRealse",
    	dataType: "json",
		type: "POST",
		data: JSON.stringify(data),
		contentType : "application/json;charset=UTF-8",
		success: function(res) {
		     if (res.data.result!="success") {
		         alert(res.data.result);
		 		 alert("商品发布失败，请检查后重新发布");
		 		 window.parent.window.location.reload();
		     } else {
			 	 alert(res.data.result);
			 	 window.parent.window.location.reload();
		         window.location.href="/second_hand";
		     }
		},
    });
 }
</script>
</html>